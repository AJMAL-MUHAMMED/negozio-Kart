
<head>
    <title>Shoping Cart</title>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <!--===============================================================================================-->
    <link rel="icon" type="image/png" href="images/icons/favicon.png" />
    <!--===============================================================================================-->
    <link rel="stylesheet" type="text/css" href="vendor/bootstrap/css/bootstrap.min.css">
    <!--===============================================================================================-->
    <link rel="stylesheet" type="text/css" href="fonts/font-awesome-4.7.0/css/font-awesome.min.css">
    <!--===============================================================================================-->
    <link rel="stylesheet" type="text/css" href="fonts/iconic/css/material-design-iconic-font.min.css">
    <!--===============================================================================================-->
    <link rel="stylesheet" type="text/css" href="fonts/linearicons-v1.0.0/icon-font.min.css">
    <!--===============================================================================================-->
    <link rel="stylesheet" type="text/css" href="vendor/animate/animate.css">
    <!--===============================================================================================-->
    <link rel="stylesheet" type="text/css" href="vendor/css-hamburgers/hamburgers.min.css">
    <!--===============================================================================================-->
    <link rel="stylesheet" type="text/css" href="vendor/animsition/css/animsition.min.css">
    <!--===============================================================================================-->
    <link rel="stylesheet" type="text/css" href="vendor/select2/select2.min.css">
    <!--===============================================================================================-->
    <link rel="stylesheet" type="text/css" href="vendor/perfect-scrollbar/perfect-scrollbar.css">
    <!--===============================================================================================-->
    <link rel="stylesheet" type="text/css" href="/css/util.css">
    <link rel="stylesheet" type="text/css" href="/css/main.css">
    <!--===============================================================================================-->
</head>


<body class="animsition">

    <!-- Header -->


    <!-- Cart -->



    <!-- breadcrumb -->
    <div class="container">
        <div class="bread-crumb flex-w p-l-25 p-r-15 p-t-30 p-lr-0-lg">
            <a href="/" class="stext-109 cl8 hov-cl1 trans-04">
                Home
                <i class="fa fa-angle-right m-l-9 m-r-10" aria-hidden="true"></i>
            </a>
            <a href="/proceed-to-checkout/shoping-cart" class="stext-109 cl8 hov-cl1 trans-04">
                Shoping Cart
                <i class="fa fa-angle-right m-l-9 m-r-10" aria-hidden="true"></i>
            </a>
            <span class="stext-109 cl4">
                Checkout
            </span>
        </div>
    </div>


    <!-- Shoping Cart -->
    <div class="bg0 p-t-75 p-b-85">
        <div class="container">
            <form id="checkoutForm">
                <div class="row">

                    <div class="col-lg-10 col-xl-7 m-lr-auto m-b-50">
                        <div class="m-l-25 m-r--38 m-lr-0-xl">
                            <div class="wrap-table-shopping-cart">
                                <table class="table-shopping-cart">
                                    <tr class="table_head">
                                        <th class="column-1">Product</th>
                                        <th class="column-2"></th>
                                        <th class="column-1"></th>
                                        <th class="column-3">Price</th>
                                        <th class="column-4">Quantity</th>
                                        <th class="column-5">Total</th>
                                    </tr>
                                    {{#each products}}
                                    <tr class="table_row">

                                        <td class="column-1">
                                            <div class="how-itemcart1">
                                                <img src="product-images/{{this.product.images.[0]}}" alt="IMG">
                                            </div>
                                        </td>
                                        <td class="column-2">{{this.product.productname}}</td>
                                        <td class="column-2"></td>
                                        <td class="column-3" style="  font-family: Arial, Helvetica, sans-serif;">
                                            {{this.product.price}}</td>

                                        <td class="column-1 " id="{{this.product._id}}-total">
                                            <span id="{{this.product._id}}-total" style=""> {{this.quantity}}</span>
                                        </td>
                                        <td class="column-5"
                                            style=" margin-left: 20px; font-family: Arial, Helvetica, sans-serif;">
                                            â‚¹{{total this.product.price this.quantity}}</td>
                                    </tr>
                                    {{/each}}
                                </table>
                            </div>
                            <input type="text" name="userId" value="{{user._id}}" hidden>




                        </div>
                    </div>

                    <div class="col-sm-10 col-lg-7 col-xl-5 m-lr-auto m-b-50">
                        <div class="bor10 p-lr-40 p-t-30 p-b-40 m-l-63 m-r-40 m-lr-0-xl p-lr-15-sm">
                            <h4 class="mtext-109 cl2 p-b-30">
                                Price Details
                            </h4>

                            <div class="flex-w flex-t  ">
                                <div class="size-208">
                                    <span class="stext-110 cl2">
                                        Subtotal:
                                    </span>
                                </div>

                                <div class="size-209">
                                    <input class="mtext-110 cl2" id="subtotal" name="subtotal"
                                        style=" border :none;font-family: Arial, Helvetica, sans-serif;" {{#if
                                        totalValue }} value="{{totalValue }}" {{else}}value="00" {{/if}} />


                                </div>
                            </div>

                            <hr>
                            <div class="flex-w flex-t  ">
                                <div class="size-208">
                                    <span class="stext-110 cl2">
                                        Discount:
                                    </span>
                                </div>

                                <div class="size-209">
                                    <span class="mtext-110 cl2"
                                        style="  font-family: Arial, Helvetica, sans-serif; color:green">
                                        {{#if coupon}} {{coupon}} {{else}} 00 {{/if}}
                                    </span>
                                </div>
                            </div>
                            <hr>
                            <div class="flex-w flex-t  ">
                                <div class="size-208">
                                    <span class="stext-110 cl2">
                                        DDC:
                                    </span>
                                </div>

                                <div class="size-209">
                                    <input class="mtext-110 cl2" name="DDC"
                                        style="  font-family: Arial, Helvetica, sans-serif;" {{#if totalValue}}
                                        value="45" {{else}} value=" 00" {{/if}} />


                                </div>
                            </div>
                            <hr>
                            <div class="flex-w flex-t p-t-27 p-b-33">
                                <div class="size-208">
                                    <span class="mtext-101 cl2">
                                        Total :
                                    </span>
                                </div>

                                <div class="size-209 p-t-1">
                                    <input class="mtext-110 cl2" id="allTotal" name="grandtotal"
                                        style="font-family: Arial, Helvetica, sans-serif;" {{#if totalValue}}
                                        value="{{ add 45 totalValue coupon}}" {{else}} value=" 00" {{/if}}>


                                </div>
                            </div>
                            <div class="flex-w flex-t p-t-27 p-b-33">

                                <div class="size-203 flex-c-m respon6 py-4">
                                    <b> Address :</b>
                                </div>
                                <div class="size-204 respon6-next py-4">
                                    <div class="rs1-select2 bor8 bg0">
                                        <select class="js-select2" name="addres" id="addres">
                                            <option name="address">Choose an option</option>
                                            {{#each address}}
                                            <option id="address" name="address">
                                                {{this.Data.fullname}},
                                                <br>{{this.Data.city}},<br>
                                                {{this.Data.pincode}}
                                                <br>{{this.Data.mobileno}},<br>
                                                {{this.Data.address}}
                                            </option>
                                            {{/each}}
                                        </select>
                                        <div class="dropDownSelect2"></div>
                                    </div>
                                </div>

                                <button type="button"
                                    class=" flex-c-m stext-101 cl0 size-116 bg3  hov-btn3 p-lr-10 trans-04 pointer mb-3"
                                    style="margin-left: 7rem;" data-toggle="modal" data-target="#exampleModal-address">
                                    Add New Address
                                </button>


                                <div class="size-203 flex-c-m respon6 py-4">
                                    <b> Payment :</b>
                                </div>

                                <div class="size-204 respon6-next py4">
                                    <div class="rs1-select2 bor8 bg0">
                                        <select class="js-select2" name="payment-method" id="paymentMmethod">
                                            <option>Choose an option</option>
                                            <option>Cash On Delivery</option>
                                            <option>Razorpay Payment</option>
                                        </select>
                                        <div class="dropDownSelect2"></div>
                                    </div>
                                </div>
                            </div>
                            <button type="submit"
                                class="flex-c-m stext-101 cl0 size-116 bg3 bor14 hov-btn3 p-lr-15 trans-04 pointer">
                                Place Order
                            </button>
                        </div>
                    </div>
                </div>
            </form>
        </div>
    </div>

    {{!-- modal add address --}}
    <div class="modal fade" id="exampleModal-address" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel"
        aria-hidden="true">
        <div class="modal-dialog" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="exampleModalLabel">Add New Addres</h5>
                </div>
                <form action="/proceed-to-checkout/Add" method="post" id="myform">
                    <div class="modal-body">
                        <div class="row">
                            <div class="col-12 mb-4">
                                <div class="card mb-4">
                                    <div class="card-body">



                                        <div class=" form-outline mb-4">
                                            <label class="form-label" for="fullname">Full
                                                Name</label>
                                            <input type="text" name="fullname" id="form7Example3"
                                                class="form-control" />

                                        </div>

                                        <!-- Text input -->
                                        <div class="  form-outline mb-4">
                                            <label class="form-label" for="landmark">Landmark</label>
                                            <input type="text" name="landmark" id="form7Example3"
                                                class="form-control" />

                                        </div>

                                        <!-- Text input -->
                                        <div class=" colform-outline mb-4">
                                            <label class="form-label" for="city">City</label>
                                            <input type="text" name="city" id="form7Example4" class="form-control" />

                                        </div>

                                        <!-- Email input -->
                                        <div class="form-outline mb-4">
                                            <label class="form-label" for="pincode">Pin
                                                Code</label>
                                            <input type="number" name="pincode" id="form7Example5"
                                                class="form-control" />

                                        </div>

                                        <!-- Number input -->
                                        <div class="form-outline mb-4">
                                            <label class="form-label" for="mobileno">Mobile
                                                No</label>
                                            <input type="number" name="mobileno" id="form7Example6"
                                                class="form-control" />

                                        </div>

                                        <!-- Message input -->
                                        <div class="form-outline mb-4">
                                            <label class="form-label" for="address">Address</label>
                                            <textarea class="form-control" name="address" id="form7Example7"
                                                rows="4"></textarea>

                                        </div>


                                    </div>
                                </div>
                            </div>


                        </div>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
                        <button type="submit" class="btn btn-primary">Add Address</button>
                    </div>
                </form>
            </div>
        </div>
    </div>
    {{!-- mdal end --}}



    <script src="https://code.jquery.com/jquery-3.2.1.slim.min.js"
        integrity="sha384-KJ3o2DKtIkvYIK3UENzmM7KCkRr/rE9/Qpg6aAZGJwFDMVNA/GpGFF93hXpG5KkN"
        crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/popper.js@1.12.9/dist/umd/popper.min.js"
        integrity="sha384-ApNbgh9B+Y1QKtv3Rn7W3mgPxhU9K/ScQsAP7hUibX39j7fakFPskvXusvfa0b4Q"
        crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.0.0/dist/js/bootstrap.min.js"
        integrity="sha384-JZR6Spejh4U02d8jOt6vLEHfe/JQGiRRSQQxSfFWpi1MquVdAyjUar5+76PVCmYl"
        crossorigin="anonymous"></script>




    <!--===============================================================================================-->
    <script src="/vendor/jquery/jquery-3.2.1.min.js"></script>
    <!--===============================================================================================-->
    <script src="/vendor/animsition/js/animsition.min.js"></script>
    <!--===============================================================================================-->
    <script src="/vendor/bootstrap/js/popper.js"></script>
    <script src="/vendor/bootstrap/js/bootstrap.min.js"></script>
    <!--===============================================================================================-->
    <script src="/vendor/select2/select2.min.js"></script>
    <script>
        $(".js-select2").each(function () {
            $(this).select2({
                minimumResultsForSearch: 20,
                dropdownParent: $(this).next('.dropDownSelect2')
            });
        })
    </script>
    <!--===============================================================================================-->
    <script src="/vendor/MagnificPopup/jquery.magnific-popup.min.js"></script>
    <!--===============================================================================================-->
    <script src="/vendor/perfect-scrollbar/perfect-scrollbar.min.js"></script>
    <script>
        $('.js-pscroll').each(function () {
            $(this).css('position', 'relative');
            $(this).css('overflow', 'hidden');
            var ps = new PerfectScrollbar(this, {
                wheelSpeed: 1,
                scrollingThreshold: 1000,
                wheelPropagation: false,
            });

            $(window).on('resize', function () {
                ps.update();
            })
        });
    </script>


    {{!-- place order form submiy --}}

    <script>
        $("#checkoutForm").submit((e) => {
            e.preventDefault();
            if (document.getElementById("addres").value === "Choose an option") {
                swal("Confirm", "Please select your Addres", "warning")
            } else if (document.getElementById("paymentMmethod").value === "Choose an option") {
                swal("Confirm", "Please select your Payment Method", "warning")
            } else {
                $.ajax({
                    url: '/place-order',
                    method: 'post',
                    data: $('#checkoutForm').serialize(),
                    success: (response) => {
                        if (response.Cash_On_Delivery) {
                            location.href = '/order-success'
                        } else {
                            razorpayPayment(response)
                        }
                    }
                })
            }

        });

        function razorpayPayment(order) {
            var options = {
                "key": "rzp_test_wPFOnh2l9CvLcs", // Enter the Key ID generated from the Dashboard
                "amount": order.amount, // Amount is in currency subunits. Default currency is INR. Hence, 50000 refers to 50000 paise
                "currency": "INR",
                "name": "negozio-Kart",
                "description": "Test Transaction",
                "image": "https://example.com/your_logo",
                "order_id": order.id, //This is a sample Order ID. Pass the `id` obtained in the response of Step 1
                "handler": function (response) {
                    // alert(response.razorpay_payment_id);
                    // alert(response.razorpay_order_id);
                    // alert(response.razorpay_signature);
                    verifyPayment(response, order)
                },
                "prefill": {
                    "name": "Gaurav Kumar",
                    "email": "gaurav.kumar@example.com",
                    "contact": "9999999999"
                },
                "notes": {
                    "address": "Razorpay Corporate Office"
                },
                "theme": {
                    "color": "#3399cc"
                }
            };

            var rzp1 = new Razorpay(options);
            rzp1.open();

        };
        function verifyPayment(payment, order) {
            $.ajax({
                url: '/verify-payment',
                data: {
                    payment,
                    order
                },
                method: 'post',
                success: (response) => {
                    if (response.status) {
                        location.href = '/order-success'
                    } else {
                        swal("Order", "Payment Failed... !", "error")
                    }
                }
            })
        }
    </script>








    <!--===============================================================================================-->
    <script src="/js/main.js"></script>

</body>

</html>

<style>
    hr {
        border: none;
        border-top: 1px dashed rgb(0, 0, 0);
        color: #fff;
        background-color: #fff;
        height: 1px;
        width: 100%;
    }

    input {
        border: none;
        pointer-events: none;
    }
    a{
        text-decoration: none;
    }
</style>


<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery-validate/1.19.5/jquery.validate.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery-validate/1.19.5/additional-methods.js"></script>
<script>

    $(document).ready(function () {
        $("#myform").validate({
            rules: {
                fullname: {
                    required: true,

                },
                landmark: {
                    required: true,

                },
                city: {
                    required: true,
                },
                pincode: {
                    required: true,
                },
                mobileno: {
                    required: true,
                    minlength: 10,
                    maxlength: 10
                },
                address: {
                    required: true,
                }

            },
            messages: {
                fullname: {
                    required: "Please enter your Full Name",

                },
                landmark: {
                    required: "Please enter your Landmark",

                },
                city: {
                    required: "Please enter your city",
                },
                pincode: {
                    required: "Please enter your pincode",
                },
                mobileno: {
                    required: "Please enter your Mobile Number",
                    minlength: "Minimum 10 numbers",
                    maxlength: "Maximum 10 numbers"
                },
                address: {
                    required: "Please enter your Address",
                }
            }
        })
    })
</script>